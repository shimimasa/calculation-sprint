# 計算スプリント 技術仕様書（追記 v1.1）

## 目的（v1.1）

v1.0 で実装した「速度 × 正確性」の可視化を一段階進め、
**現場での導入スピード向上**と**次の指導アクションが即座に判断できる状態**を作る。

v1.1 では以下の3点のうち、**①プリセット機能を必須**、②③は拡張余地として定義する。

---

## v1.1 機能一覧

### ① 難易度プリセット（必須）

#### 機能概要

* 学年・レベル別に、設定（mode / digit / carry）をまとめた「プリセット」を選択できる
* 設定画面で **ラジオボタン or セレクトボックス 1つ**で反映
* プリセット選択後も、手動で微調整できる（上書き可能）

#### 目的

* 教師・支援員が設定を考える時間を削減
* 子どもを待たせず、即スタートできる

#### 想定プリセット例（固定）

| key        | 表示名       | mode    | digit | carry |
| ---------- | --------- | ------- | ----- | ----- |
| p3-basic   | 小3 基本     | add/sub | 1     | false |
| p4-nocarry | 小4 繰上がりなし | add/sub | 2     | false |
| p4-carry   | 小4 繰上がりあり | add/sub | 2     | true  |
| p5-mul     | 小5 九九     | mul     | 1     | true  |
| mix-basic  | ミックス      | mix     | 1     | true  |

※ mode が複数の場合は内部的に mix 扱いで、対象演算のみ出題

---

### ② 平均回答時間（拡張・v1.1では下地のみ）

#### 機能概要

* 各問題の回答時間を計測
* 結果画面で「平均 ○.○ 秒 / 問」を表示

#### v1.1 方針

* 実装は optional
* gameState に以下の値だけ追加してもよい

  * totalAnswerTime
  * lastQuestionStartTime

---

### ③ ミス傾向の可視化（拡張・v1.2以降）

#### 機能概要（設計のみ）

* mode（add/sub/mul/div）ごとにミス数を集計
* 結果画面 or ログ用に保持

#### v1.1 方針

* questionGenerator が返す `meta.mode` を利用
* UI表示は行わず、集計用の構造だけ想定

---

## 画面仕様変更（v1.1）

### 設定画面（settings-screen）

#### 追加UI

* プリセット選択欄

  * label: 「難易度プリセット」
  * input: select または radio

#### 挙動

1. プリセット選択
2. 対応する settings（mode/digit/carry）を gameState.settings に反映
3. 既存の個別設定UI（mode/digit/carry）も同時に更新される

---

## データ構造（追加/変更）

### presets 定義（新規）

```js
const PRESETS = {
  p3-basic: { mode: 'mix', allowedModes: ['add','sub'], digit: 1, carry: false },
  p4-nocarry: { mode: 'mix', allowedModes: ['add','sub'], digit: 2, carry: false },
  p4-carry: { mode: 'mix', allowedModes: ['add','sub'], digit: 2, carry: true },
  p5-mul: { mode: 'mul', digit: 1, carry: true },
};
```

※ allowedModes は questionGenerator 側で参照してもよい（v1.1では必須ではない）

---

## 非対応（v1.1ではやらない）

* データ保存（localStorage / DB）
* ランキング
* 効果音・演出追加
* スマホUI最適化

---

## v1.1 完了条件

* プリセットを選ぶだけで適切な設定が反映される
* 既存の v1.0 機能（タイマー/フィードバック/結果表示）が壊れていない
* 設定→ゲーム→結果→リトライ/戻る が従来どおり動作
