<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>計算スプリント</title>
    <!-- ADR-004: Use scoped CSS and keep asset paths relative so subpath hosting works. -->
    <link rel="stylesheet" href="styles/style.scoped.css" />
  </head>
  <body>
    <!-- ADR-004: Scope styles under a dedicated app root to avoid collisions when embedded in a portal. -->
    <main class="calc-sprint">
      <div class="app">
      <section id="profile-select-screen" class="screen screen-profile-select is-active">
        <header class="screen-header">
          <p class="screen-kicker">PROFILE</p>
          <h1 class="screen__title">プロファイルをえらぼう</h1>
          <p class="screen__description">なまえは入れずに、番号だけえらんでね</p>
        </header>
        <div class="screen-main stage-card">
          <div class="profile-select-grid" role="group" aria-label="プロファイル一覧">
            <button class="profile-select-button" data-profile-id="A" type="button" aria-pressed="false">A</button>
            <button class="profile-select-button" data-profile-id="B" type="button" aria-pressed="false">B</button>
            <button class="profile-select-button" data-profile-id="C" type="button" aria-pressed="false">C</button>
            <button class="profile-select-button" data-profile-id="D" type="button" aria-pressed="false">D</button>
            <button class="profile-select-button" data-profile-id="E" type="button" aria-pressed="false">E</button>
            <button class="profile-select-button" data-profile-id="F" type="button" aria-pressed="false">F</button>
            <button class="profile-select-button" data-profile-id="G" type="button" aria-pressed="false">G</button>
            <button class="profile-select-button" data-profile-id="H" type="button" aria-pressed="false">H</button>
          </div>
          <p class="profile-select-current">現在の選択: <strong id="profile-select-current">A</strong></p>
        </div>
        <footer class="screen-footer">
          <button id="profile-select-continue" class="primary-button primary-button--xl">タイトルへすすむ</button>
        </footer>
      </section>

      <section id="title-screen" class="screen screen-title" hidden>
        <header class="screen-header">
          <p class="screen-kicker">DASH RUN</p>
          <h1 class="screen__title">計算スプリント</h1>
          <p class="screen__description">問題に正解して走れ！敵を倒しながらできるだけ遠くへ進もう！</p>
        </header>
        <div class="screen-main stage-card">
          <div class="mission-card">
            <p class="mission-label">MISSION</p>
            <p class="mission-text">
              制限時間内により遠くまで走れ！<br>
              正解でスピードアップ、敵を撃破！
            </p>
          </div>
          <div class="title-actions">
            <button id="title-dash-button" class="secondary-button primary-button--xl">ダッシュラン</button>
            <button id="title-dash-settings-button" class="secondary-button primary-button--xl">ダッシュ設定</button>
            <button id="title-dash-stats-button" class="secondary-button primary-button--xl">ダッシュ記録/統計</button>
          </div>
          <div class="how-to">
            <p class="how-to__title">遊び方</p>
            <ol class="how-to__list">
              <li>問題に正解するとスピードアップ</li>
              <li>敵にぶつかるとタイム減少</li>
              <li>できるだけ遠くまで走ろう</li>
            </ol>
          </div>
        </div>
        <footer class="screen-footer">
          <p class="screen-hint">ステージを選んでダッシュ開始！</p>
        </footer>
      </section>

      <section id="dash-stage-select-screen" class="screen screen-stage-select" hidden>
        <header class="dash-stage-select-header">
          <h2 class="dash-stage-select-header__title">ダッシュステージをえらぼう</h2>
          <p id="dash-stage-select-mode-note" class="setting-note dash-stage-select-header__note">じかんをのばして どこまでいける？</p>
          <div id="dash-mode-select-list" class="dash-mode-select-list" role="tablist" aria-label="ダッシュモード選択">
            <button class="secondary-button" type="button" data-dash-mode-id="infinite">Infinite（とことん）</button>
            <button class="secondary-button" type="button" data-dash-mode-id="goalRun">GoalRun（1000mチャレンジ）</button>
            <button class="secondary-button" type="button" data-dash-mode-id="scoreAttack60">ScoreAttack60（60びょうスコア）</button>
          </div>
        </header>
        <div id="dash-stage-select-list" class="stage-select-list" role="list" aria-label="ダッシュステージ一覧">
          <button class="secondary-button" type="button" data-dash-stage-id="plus">
            <span>たし算</span>
            <small>たし算だけが出るステージ</small>
          </button>
          <button class="secondary-button" type="button" data-dash-stage-id="minus">
            <span>ひき算</span>
            <small>ひき算だけが出るステージ</small>
          </button>
          <button class="secondary-button" type="button" data-dash-stage-id="multi">
            <span>かけ算</span>
            <small>かけ算だけが出るステージ</small>
          </button>
          <button class="secondary-button" type="button" data-dash-stage-id="divide">
            <span>わり算</span>
            <small>わり算だけが出るステージ</small>
          </button>
          <button class="secondary-button" type="button" data-dash-stage-id="mix">
            <span>ミックス</span>
            <small>4つの演算がランダムで出るステージ</small>
          </button>
        </div>
        <section id="dash-level-select-panel" class="dash-level-select-panel" hidden>
          <h3 class="dash-level-select-panel__title">レベルをえらぼう</h3>
          <div id="dash-level-select-list" class="dash-level-select-list" role="list" aria-label="レベル一覧"></div>
        </section>
        <div class="stage-select-actions">
          <button id="dash-stage-select-start-button" class="secondary-button" type="button" hidden>このレベルでスタート</button>
          <button id="dash-stage-select-back-button" class="secondary-button" type="button">戻る（キャンセル）</button>
        </div>
      </section>

      <section
        id="stage-select-screen"
        class="screen screen-stage-select"
        data-world-id="default"
        data-theme-id="default"
        hidden
      >
        <header class="screen-header">
          <p class="screen-kicker">STAGE SELECT</p>
          <h2 class="screen__title">ステージであそぶ</h2>
          <p class="screen__description">おすすめ課題をえらぼう</p>
        </header>
        <div class="screen-main stage-card">
          <div id="stage-select-list" class="stage-select-list"></div>
        </div>
        <footer class="screen-footer stage-select-footer">
          <button id="stage-select-free-button" class="secondary-button">じゆうにあそぶ</button>
          <button id="stage-select-back-button" class="secondary-button">タイトルにもどる</button>
        </footer>
      </section>

      <section id="settings-screen" class="screen screen-settings" hidden>
        <header class="screen-header">
          <p class="screen-kicker">STAGE 02</p>
          <h2 class="screen__title" id="settings-title">設定</h2>
          <p class="screen__description">ミッションに合わせてルールをえらぼう</p>
        </header>
        <div class="screen-main stage-card">
          <div class="settings-section settings-section--preset">
            <p class="section-title">🎯 プリセット</p>
            <div class="form-group">
              <label class="form-label" for="settings-preset">おすすめプリセット</label>
              <select id="settings-preset">
                <option value="" disabled>おすすめをえらぶ（プリセット）</option>
                <option value="p3-basic">🟢 はじめてラン</option>
                <option value="p4-nocarry">🔵 ふつうラン</option>
                <option value="p4-carry">🟠 ちょうせんラン</option>
                <option value="p5-mul">🟣 きゅうきゅうラン</option>
                <option value="custom" selected>なし（カスタム）</option>
              </select>
              <p class="settings-preset-description" id="settings-preset-description">
                <span class="settings-preset-tag" id="settings-preset-tag">カスタム中</span>
                <span id="settings-preset-text">こまかく設定で自分で作れるよ。</span>
              </p>
            </div>
          </div>
          <p class="settings-guide">まずはおすすめをえらぼう！こまかく変えたいときは下をひらくよ</p>
          <details class="settings-details">
            <summary class="settings-details__summary">こまかく設定</summary>
            <div class="settings-section">
              <p class="section-title">🧮 モード</p>
              <div class="pill-group">
                <label class="pill-option"><input type="radio" name="mode" value="add" checked /><span>たし算</span></label>
                <label class="pill-option"><input type="radio" name="mode" value="sub" /><span>ひき算</span></label>
                <label class="pill-option"><input type="radio" name="mode" value="mul" /><span>かけ算</span></label>
                <label class="pill-option"><input type="radio" name="mode" value="div" /><span>わり算</span></label>
                <label class="pill-option"><input type="radio" name="mode" value="mix" /><span>ミックス</span></label>
              </div>
            </div>
            <div class="settings-section">
              <p class="section-title">🔢 桁数</p>
              <div class="pill-group">
                <label class="pill-option"><input type="radio" name="digit" value="1" checked /><span>1桁</span></label>
                <label class="pill-option"><input type="radio" name="digit" value="2" /><span>2桁</span></label>
              </div>
              <p class="settings-note">1けたのいみ：たし・かけは数が1けた、ひきは答えが1けた、わりは商が1けた</p>
            </div>
            <div class="settings-section">
              <p class="section-title">⚙️ オプション</p>
              <label class="toggle-option">
                <input type="checkbox" id="settings-carry" />
                <span>繰り上がり/繰り下がり</span>
              </label>
            </div>
            <div class="settings-section">
              <p class="section-title">🧹 リセット</p>
              <p class="settings-note">選択中プロファイルの記録を消去します。</p>
              <button id="settings-profile-reset" class="secondary-button">このプロファイルをリセット</button>
              <div id="settings-admin-reset" hidden>
                <p class="settings-note">管理者用: すべての記録を消去します。</p>
                <button id="settings-admin-reset-button" class="secondary-button">全データ消去</button>
              </div>
            </div>
          </details>
        </div>
        <footer class="screen-footer">
          <div class="title-actions">
            <button id="settings-play-button" class="primary-button primary-button--xl">プレイ</button>
            <button id="settings-profile-button" class="secondary-button">プロファイル変更</button>
          </div>
        </footer>
      </section>

      <section id="dash-game-screen" class="screen screen-dash" hidden>
        <div class="dash-top-hud">
          <div class="dash-top-controls" aria-label="問題と入力エリア">
            <div class="dash-top-cluster">
              <div class="dash-problem-grid" aria-label="問題入力エリア">
                <div class="dash-problem-main">
                  <div class="question-area problem-frame">
                    <div class="dash-problem-panel"><div id="dash-game-question" class="question-text problem-frame__text">1 + 1</div></div>
                    <input
                      id="dash-game-answer-input"
                      type="number"
                      class="answer-input problem-frame__input"
                      autocomplete="off"
                    />
                  </div>
                  <div id="dash-game-feedback" class="feedback" aria-live="polite"></div>
                  <div class="game-actions" aria-label="入力操作">
                    <div class="game-action-row">
                      <button
                        id="dash-game-keypad-toggle"
                        class="secondary-button"
                        type="button"
                        aria-expanded="false"
                        aria-controls="dash-game-keypad"
                      >
                        テンキー
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="dash-keypad-stack" aria-label="テンキー操作">
                <div id="dash-game-keypad" class="game-keypad" hidden aria-hidden="true">
                  <button class="keypad-button" type="button" data-digit="7">7</button>
                  <button class="keypad-button" type="button" data-digit="8">8</button>
                  <button class="keypad-button" type="button" data-digit="9">9</button>
                  <button class="keypad-button" type="button" data-digit="4">4</button>
                  <button class="keypad-button" type="button" data-digit="5">5</button>
                  <button class="keypad-button" type="button" data-digit="6">6</button>
                  <button class="keypad-button" type="button" data-digit="1">1</button>
                  <button class="keypad-button" type="button" data-digit="2">2</button>
                  <button class="keypad-button" type="button" data-digit="3">3</button>
                  <button class="keypad-button keypad-button--wide" type="button" data-digit="0">
                    0
                  </button>
                  <button class="keypad-button keypad-button--action" type="button" data-action="backspace">
                    ⌫
                  </button>
                </div>
                <div class="dash-keypad-actions" aria-label="確定操作">
                  <button id="dash-game-submit-button" class="primary-button primary-button--xl dash-submit-button" type="button" data-action="submit">
                    確定
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="dash-run-zone">
          <!-- Normal-mode run-layer is DOM-moved here during Dash Run for visual continuity. -->
          <div class="run-viewport" aria-hidden="true">
            <div class="run-host" aria-hidden="true"></div>
          </div>
          <div id="dash-goal-overlay" class="dash-goal-overlay" aria-hidden="true">
            <img id="dash-goal-overlay-image" class="dash-goal-overlay__image" alt="" />
            <p id="dash-goal-overlay-text" class="dash-goal-overlay__text">GOAL!</p>
          </div>
        </div>
        <div class="dash-bottom-hud" aria-label="ダッシュステータス">
          <div id="dash-game-time-wrap" class="dash-time dash-time-hud" aria-label="残り時間">
            <div class="dash-timebar" aria-hidden="true">
              <div id="dash-game-timebar" class="dash-timebar__fill"></div>
            </div>
            <div class="dash-timevalue" aria-label="残り秒数">
              <strong id="dash-game-time" class="dash-time-seconds">30</strong>
              <span class="dash-time-unit">秒</span>
            </div>
            <div id="dash-game-time-note" class="dash-time-note" aria-live="polite"></div>
          </div>
          <div class="dash-bottom-stats" aria-label="ステータス">
            <div class="dash-stat-card">
              <span class="dash-stat-label">はやさ</span>
              <strong id="dash-game-speed" class="dash-stat-value">0.0</strong>
              <span class="dash-stat-unit">m/s</span>
            </div>
            <div class="dash-stat-card">
              <span class="dash-stat-label">走ったきょり</span>
              <strong id="dash-game-distance" class="dash-stat-value">0.0</strong>
              <span class="dash-stat-unit">m</span>
            </div>
            <div class="dash-stat-card">
              <span class="dash-stat-label">たおした敵の数</span>
              <strong id="dash-game-enemy-count" class="dash-stat-value">0</strong>
              <span class="dash-stat-unit">体</span>
            </div>
            <div class="dash-stat-card">
              <span class="dash-stat-label">せいかいコンボ</span>
              <strong id="dash-game-streak" class="dash-stat-value">0</strong>
              <span class="dash-stat-unit">回</span>
              <span id="dash-game-streak-cue" class="dash-streak-cue" aria-live="polite"></span>
            </div>
            <div class="dash-exit-card" aria-label="ステージ操作">
              <button id="dash-game-back-button" class="secondary-button" type="button">⏏ 退出</button>
            </div>
          </div>
        </div>
      </section>

      <section id="dash-result-screen" class="screen screen-dash screen-dash-result" hidden>
        <header class="screen-header dash-result-header">
          <p class="screen-kicker">DASH RUN</p>
          <h2 class="screen__title">ダッシュ記録</h2>
          <p class="screen__description">落ち着いて見られる記録を表示します。</p>
        </header>
        <div class="screen-main dash-result-main">
          <p id="dash-result-message" class="dash-result-message" hidden>記録が見つかりませんでした。</p>
          <div id="dash-result-record" class="dash-result-record">
            <p id="dash-result-stage" class="dash-result-stage">ステージ：たし算</p>
            <p id="dash-result-reason" class="dash-result-reason" hidden>終了理由：不明</p>
            <div class="dash-result-grid" aria-label="ダッシュ記録">
              <div class="dash-stat-card">
                <span class="dash-stat-label">距離</span>
                <strong id="dash-result-distance" class="dash-stat-value">0.0</strong>
                <span class="dash-stat-unit">m</span>
              </div>
              <div class="dash-stat-card">
                <span class="dash-stat-label">正解数</span>
                <strong id="dash-result-correct" class="dash-stat-value">0</strong>
                <span class="dash-stat-unit">問</span>
              </div>
              <div class="dash-stat-card">
                <span class="dash-stat-label">不正解数</span>
                <strong id="dash-result-wrong" class="dash-stat-value">0</strong>
                <span class="dash-stat-unit">問</span>
              </div>
              <div class="dash-stat-card">
                <span class="dash-stat-label">たおした敵の数</span>
                <strong id="dash-result-defeated" class="dash-stat-value">0</strong>
                <span class="dash-stat-unit">体</span>
              </div>
              <div class="dash-stat-card">
                <span class="dash-stat-label">正答率</span>
                <strong id="dash-result-accuracy" class="dash-stat-value">0.0</strong>
                <span class="dash-stat-unit">%</span>
              </div>
            <div class="dash-stat-card">
              <span class="dash-stat-label">ミス率</span>
              <strong id="dash-result-miss-rate" class="dash-stat-value">0.0</strong>
              <span class="dash-stat-unit">%</span>
            </div>
              <div class="dash-stat-card">
                <span class="dash-stat-label">最大連続正解</span>
                <strong id="dash-result-max-streak" class="dash-stat-value">0</strong>
                <span class="dash-stat-unit">問</span>
              </div>
              <div class="dash-stat-card">
                <span class="dash-stat-label">残り時間</span>
                <strong id="dash-result-time" class="dash-stat-value">0</strong>
                <span class="dash-stat-unit">sec</span>
              </div>
            </div>
          </div>
        </div>
        <footer class="screen-footer dash-result-footer">
          <div class="title-actions">
            <button id="dash-result-replay-button" class="primary-button primary-button--xl">もう一回はしる</button>
            <button id="dash-result-settings-button" class="secondary-button primary-button--xl">設定</button>
            <button id="dash-result-stats-button" class="secondary-button primary-button--xl">記録/統計</button>
            <button id="dash-result-back-button" class="secondary-button primary-button--xl">タイトルへ戻る</button>
          </div>
        </footer>
      </section>

      <section id="dash-settings-screen" class="screen screen-dash" hidden>
        <header class="screen-header">
          <p class="screen-kicker">DASH SETTINGS</p>
          <h2 class="screen__title">ダッシュ設定</h2>
          <p class="screen__description">音量と難易度は localStorage に保存されます。</p>
        </header>
        <div class="screen-main stage-card dash-settings-card">
          <label class="dash-setting-row" for="dash-settings-bgm-toggle">
            <span>BGM</span>
            <input id="dash-settings-bgm-toggle" type="checkbox" checked />
          </label>
          <label class="dash-setting-row" for="dash-settings-sfx-toggle">
            <span>SFX</span>
            <input id="dash-settings-sfx-toggle" type="checkbox" checked />
          </label>
          <label class="dash-setting-row dash-setting-row--select" for="dash-settings-difficulty">
            <span>難易度</span>
            <select id="dash-settings-difficulty">
              <option value="easy">easy</option>
              <option value="normal" selected>normal</option>
              <option value="hard">hard</option>
            </select>
          </label>
          <p class="setting-note">※音声ON/OFFは次回再生から反映される場合があります。</p>
        </div>
        <footer class="screen-footer">
          <button id="dash-settings-back-button" class="secondary-button primary-button--xl">戻る</button>
        </footer>
      </section>

      <section id="dash-stats-screen" class="screen screen-dash" hidden>
        <header class="screen-header">
          <p class="screen-kicker">DASH STATS</p>
          <h2 class="screen__title">ダッシュ記録/統計</h2>
          <p class="screen__description">総合スコアは「走行距離 (m)」を採用しています。</p>
        </header>
        <div class="screen-main stage-card dash-stats-card">
          <p class="dash-stats-total">総合ベスト: <strong id="dash-stats-total-best">0.0</strong></p>
          <div id="dash-stats-mode-filters" class="dash-stats-mode-filters" role="tablist" aria-label="モードフィルタ">
            <button type="button" class="secondary-button" data-dash-stats-mode="infinite">Infinite</button>
            <button type="button" class="secondary-button" data-dash-stats-mode="goalRun">GoalRun</button>
            <button type="button" class="secondary-button" data-dash-stats-mode="scoreAttack60">ScoreAttack60</button>
          </div>
          <div class="dash-stats-table-wrap">
            <h3>ステージ別ベスト</h3>
            <table class="dash-stats-table">
              <thead><tr><th>ステージ</th><th>ベスト</th><th>プレイ回数</th></tr></thead>
              <tbody id="dash-stats-stage-best-body"></tbody>
            </table>
          </div>
          <div class="dash-stats-table-wrap">
            <h3>直近履歴（20件）</h3>
            <table class="dash-stats-table">
              <thead><tr><th>日時</th><th>ステージ</th><th>総合スコア</th><th>結果</th></tr></thead>
              <tbody id="dash-stats-history-body"></tbody>
            </table>
          </div>
        </div>
        <footer class="screen-footer">
          <button id="dash-stats-back-button" class="secondary-button primary-button--xl">タイトルへ戻る</button>
        </footer>
      </section>

      <section id="game-screen" class="screen game-screen" hidden>
        <div class="game-hud">
          <div class="time-progress" aria-label="経過時間の進捗">
            <span id="time-progress-start" class="time-progress__marker">スタート</span>
            <div class="time-progress__track" aria-hidden="true">
              <div id="time-progress-bar" class="time-progress__bar"></div>
              <span id="time-progress-runner" class="time-progress__runner" aria-hidden="true">🏃</span>
            </div>
            <span id="time-progress-goal" class="time-progress__marker">ゴール</span>
          </div>
          <div class="status-grid">
            <div class="status-card">
              <span class="status-label">残り時間</span>
              <strong id="game-time-left" class="status-value">60</strong>
              <span class="status-unit">s</span>
            </div>
            <div class="status-card">
              <span class="status-label">正解数</span>
              <strong id="game-correct-count" class="status-value">0</strong>
            </div>
            <div class="status-card">
              <span class="status-label">不正解数</span>
              <strong id="game-wrong-count" class="status-value">0</strong>
            </div>
            <div class="status-card">
              <span class="status-label">距離</span>
              <strong id="game-distance" class="status-value">0.0</strong>
              <span class="status-unit">m</span>
            </div>
            <div class="status-card">
              <span class="status-label">速度</span>
              <strong id="game-speed" class="status-value">0.0</strong>
              <span class="status-unit">m/s</span>
            </div>
            <div id="game-review-progress" class="status-review" hidden>復習: 0/10</div>
          </div>
        </div>
        <div class="game-focus">
          <div class="question-area problem-frame">
            <div id="game-question" class="question-text problem-frame__text">1 + 1</div>
            <input id="game-answer-input" type="number" class="answer-input problem-frame__input" autocomplete="off" />
          </div>
          <div id="game-feedback" class="feedback" aria-live="polite"></div>
          <div class="game-actions" aria-label="入力操作">
            <div class="game-action-row">
              <button id="game-submit-button" class="primary-button primary-button--xl" type="button" data-action="submit">確定</button>
              <button
                id="game-keypad-toggle"
                class="secondary-button"
                type="button"
                aria-expanded="false"
                aria-controls="game-keypad"
              >
                テンキー
              </button>
            </div>
            <div id="game-keypad" class="game-keypad" hidden aria-hidden="true">
              <button class="keypad-button" type="button" data-digit="7">7</button>
              <button class="keypad-button" type="button" data-digit="8">8</button>
              <button class="keypad-button" type="button" data-digit="9">9</button>
              <button class="keypad-button" type="button" data-digit="4">4</button>
              <button class="keypad-button" type="button" data-digit="5">5</button>
              <button class="keypad-button" type="button" data-digit="6">6</button>
              <button class="keypad-button" type="button" data-digit="1">1</button>
              <button class="keypad-button" type="button" data-digit="2">2</button>
              <button class="keypad-button" type="button" data-digit="3">3</button>
              <button
                class="keypad-button keypad-button--wide"
                type="button"
                data-digit="0"
              >
                0
              </button>
              <button class="keypad-button keypad-button--action" type="button" data-action="backspace">
                ⌫
              </button>
            </div>
          </div>
        </div>
          <div class="run-layer" aria-hidden="true">
          <div class="run-world">
            <div class="run-bg" aria-hidden="true">
              <div class="run-sky"></div>
              <div class="run-clouds"></div>
              <div class="run-ground">
                <div class="run-ground__tile run-ground__tile--a"></div>
                <div class="run-ground__tile run-ground__tile--b"></div>
              </div>
            </div>
            <div class="run-enemies" aria-hidden="true"></div>
            <div class="speed-lines"></div>
            <div class="runner-wrap">
              <span class="runner-shadow"></span>
              <!-- ADR-004: Use relative asset paths so subpath hosting works. -->
              <img
                id="runner-sprite"
                class="runner-bob"
                src="assets/runner/runner.png"
                alt="runner"
              />
            </div>
          </div>
        </div>
      </section>

      <section
        id="result-screen"
        class="screen screen-result result-screen"
        data-world-id="default"
        data-theme-id="default"
        data-clear-state="fail"
        hidden
      >
        <header class="screen-header">
          <p class="screen-kicker">RESULT</p>
          <h2 class="screen__title">結果発表</h2>
          <p class="screen__description">今回の走りをチェックしよう</p>
        </header>
        <div class="screen-main stage-card">
          <div class="result-hero">
            <div id="result-best-toast" class="best-toast best-toast--hero" hidden>自己ベスト更新！</div>
            <div class="result-confetti" aria-hidden="true">
              <span></span><span></span><span></span><span></span><span></span><span></span>
              <span></span><span></span><span></span><span></span><span></span><span></span>
            </div>
          </div>
          <div id="result-stage-panel" class="result-stage" hidden>
            <p class="result-stage__label">ステージ</p>
            <p id="result-stage-name" class="result-stage__name">---</p>
            <div class="result-stage__status">
              <p id="result-stage-status" class="result-stage__headline">プレイ完了！</p>
              <p id="result-stage-message" class="result-stage__message"></p>
              <p id="result-stage-unlock" class="result-stage__unlock" hidden></p>
            </div>
          </div>
          <div id="result-review-banner" class="review-banner" hidden>
            <h3>おつかれ！</h3>
            <p id="result-review-message"></p>
            <button id="result-next-action-button" class="primary-button" hidden></button>
          </div>
          <div class="result-firstview">
            <div class="result-metric result-metric--title">
              <p class="metric-label">今回の称号</p>
              <div class="title-badge">
                <span id="result-title">称号なし</span>
              </div>
              <p id="result-title-message" class="metric-sub">---</p>
              <p id="result-title-hint" class="title-hint" hidden></p>
            </div>
            <div id="result-distance-row" class="result-metric result-metric--distance">
              <p class="metric-label">今回の距離</p>
              <p class="metric-value">
                <span id="result-distance">0.0</span>
                <span class="metric-unit">m</span>
              </p>
              <p class="metric-sub">距離ボーナス込みの表示です。</p>
              <p class="distance-note">※速度や走行ロジックには影響しません</p>
            </div>
            <div class="result-metric">
              <p class="metric-label">正答率</p>
              <p class="metric-value">
                <span id="result-accuracy">0</span>
                <span class="metric-unit">%</span>
              </p>
              <p class="metric-sub">ミス <span id="result-wrong-count">0</span> 問</p>
            </div>
            <div id="today-rank" class="result-metric result-metric--rank">
              <div class="rank-header">
                <h3>今日の距離TOP3</h3>
                <p id="result-top3-message" class="rank-message">---</p>
              </div>
              <ol class="rank-list">
                <li><span id="rank-1">---</span></li>
                <li><span id="rank-2">---</span></li>
                <li><span id="rank-3">---</span></li>
              </ol>
              <p class="distance-note">※距離ボーナス込み</p>
            </div>
          </div>
          <details class="result-details">
            <summary>詳細を見る</summary>
            <div class="result-details__content">
              <ul class="result-list">
                <li>正解数: <strong id="result-correct-count">0</strong></li>
                <li>総回答数: <strong id="result-total-answered">0</strong></li>
                <li>平均回答時間: <strong id="result-avg-time">0.0</strong> 秒/問</li>
                <li>ベスト平均: <strong id="result-best-avg">0.0</strong> 秒/問</li>
                <li>
                  距離内訳:
                  実距離 <strong id="result-raw-distance">0.0</strong> m /
                  ボーナス <strong id="result-bonus-distance">+0.0</strong> m
                  （係数 <strong id="result-distance-multiplier">1.00</strong>）
                </li>
                <li>
                  モード別正答率:
                  加 <span id="result-rate-add">0% (0/0)</span> /
                  減 <span id="result-rate-sub">0% (0/0)</span> /
                  乗 <span id="result-rate-mul">0% (0/0)</span> /
                  除 <span id="result-rate-div">0% (0/0)</span>
                </li>
                <li>
                  ミス内訳:
                  加 <strong id="result-wrong-add">0</strong> /
                  減 <strong id="result-wrong-sub">0</strong> /
                  乗 <strong id="result-wrong-mul">0</strong> /
                  除 <strong id="result-wrong-div">0</strong>
                </li>
              </ul>
              <div class="daily-stats">
                <h3>今日の記録</h3>
                <p>ベスト平均: <strong id="daily-best-avg">0.0</strong> 秒/問</p>
                <p>ベスト距離: <strong id="daily-best-distance">0.0</strong> m</p>
                <p class="distance-note">※距離ボーナス込み</p>
                <p>回答: <strong id="daily-attempt">0</strong> / ミス: <strong id="daily-wrong">0</strong></p>

                <div id="daily-diff" hidden>
                  <h4>昨日との差</h4>
                  <p>ベスト平均: <strong id="diff-best-avg">0.0</strong> 秒</p>
                  <p>ミス: <strong id="diff-wrong">0</strong></p>
                </div>

                <button id="daily-reset-button" class="secondary-button">今日の記録をリセット</button>
              </div>
              <div class="daily-history">
                <h3>直近7日</h3>
                <table>
                  <thead>
                    <tr>
                      <th>日付</th>
                      <th>ベスト平均</th>
                      <th>ベスト距離</th>
                      <th>回答</th>
                      <th>ミス</th>
                    </tr>
                  </thead>
                  <tbody id="daily-history-body"></tbody>
                </table>
                <p id="daily-history-sum">直近7日合計：回答 0 / ミス 0 / 距離 0.0m（ボーナス込み）</p>
              </div>
            </div>
          </details>
        </div>
        <footer class="screen-footer">
          <div id="result-default-actions" class="button-row button-row--menu result-actions result-actions--default">
            <button id="result-retry-button" class="primary-button result-cta">リトライ</button>
            <button id="result-review-button" class="secondary-button result-cta" hidden>復習モードで再挑戦</button>
            <button id="result-back-button" class="secondary-button result-cta">設定に戻る</button>
          </div>
          <div id="result-stage-actions" class="button-row button-row--menu result-actions result-actions--stage" hidden>
            <button id="result-stage-retry-button" class="primary-button result-cta">もう一回</button>
            <button id="result-stage-next-button" class="primary-button result-cta">次のステージ</button>
            <button id="result-stage-select-button" class="secondary-button result-cta">ステージえらぶ</button>
          </div>
        </footer>
      </section>
      </div>
    </main>

    <script type="module" src="src/main.js"></script>
  </body>
</html>
