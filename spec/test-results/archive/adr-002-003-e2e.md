> **アーカイブ済み（notes）**: 本ファイルは当時のメモとして保管しています。正本は `spec/test-results/adr-acceptance-latest.md` を参照してください。

# ADR-002 / ADR-003 E2E 受け入れ試験結果（ローカル UI）

## 実行環境
- 実行日: 2026-02-05
- サーバー起動: `./tools/serve --port 8081`
- 対象: `http://localhost:8081/`

## Playwright 実行結果（証跡）
- **注意（正本）**: 本ファイルは手書きのメモとして残しますが、受け入れ試験の正本は `spec/test-results/adr-acceptance-latest.md`（生成物）を優先してください（ADR-005）。

- Playwright (chromium) は環境によって SIGSEGV でクラッシュすることがあります。
- その場合は **firefox 実行** または **manual runner** を使用し、結果を `adr-acceptance-latest.md` に集約してください。
- 例外ログ抜粋（参考）:

```
BrowserType.launch: Target page, context or browser has been closed
...
Received signal 11 SI_KERNEL
... chrome-headless-shell ... <process did exit: exitCode=null, signal=SIGSEGV>
```

> **補足**: 同日付でも、別ブラウザ（firefox）で PASS しているログが存在する場合があります（例: `spec/test-results/adr-002-003-e2e.log`）。\n+> 結論として、最終結果の参照先は `adr-acceptance-latest.md` に統一してください。

---

## ADR-002: 匿名プロファイル必須化 & 記録分離（T1〜T6）

> **注意**: リポジトリ内に T1〜T6 の正式定義が見当たらないため、ADR-002 の要件に基づく暫定テストケースとして整理しています。

| ID | テスト内容 | 期待結果 | 実施結果 | 再現手順（Manual） | 証跡 |
| --- | --- | --- | --- | --- | --- |
| T1 | 起動時にプロファイル選択が必須 | 起動直後はプロフィール選択画面が表示され、未選択のまま進めない | **Fail (Blocked: Playwright crash)** | 1. `http://localhost:8081/` を開く 2. プロファイル未選択の状態で次画面へ遷移できないことを確認 | Playwright SIGSEGV（上記ログ） |
| T2 | プロファイル選択・続行 | プロファイル選択で表示が更新され、続行操作が可能 | **Fail (Blocked: Playwright crash)** | 1. 任意のプロファイルを選択 2. 選択表示の更新 3. 続行ボタンの有効化/遷移を確認 | 同上 |
| T3 | 選択プロファイルの表示/保持 | 設定画面等で選択中プロファイルが一致する | **Fail (Blocked: Playwright crash)** | 1. プロファイル選択後にタイトル/設定へ 2. 選択プロファイル表示が一致することを確認 | 同上 |
| T4 | プロファイル変更導線 | 設定からプロファイル変更で選択画面へ戻る | **Fail (Blocked: Playwright crash)** | 1. 設定画面から「プロファイル変更」を実行 2. プロファイル選択画面に戻る | 同上 |
| T5 | プロファイル別データ分離 | Aの記録がBに混在しない | **Fail (Blocked: Playwright crash)** | 1. Aで1セッション実施 2. Bへ切替 3. 記録/進捗が初期状態であることを確認 | 同上 |
| T6 | プロファイル単位リセット | リセットが選択中プロファイルのみ対象 | **Fail (Blocked: Playwright crash)** | 1. Aで記録作成 2. リセット実行 3. Bの記録は残ることを確認 | 同上 |

---

## ADR-003: 入力 I/F 統一（Enter/クリック/テンキー/連打/タイムアップ直前）

| ID | テスト内容 | 期待結果 | 実施結果 | 再現手順（Manual） | 証跡 |
| --- | --- | --- | --- | --- | --- |
| E1 | Enter で回答確定 | Enter がショートカットとして機能し、確定できる | **Fail (Blocked: Playwright crash)** | 1. ゲーム開始 2. 入力後 Enter を押下 3. 正誤判定へ遷移 | Playwright SIGSEGV（上記ログ） |
| E2 | クリック（確定ボタン）で回答確定 | 画面上の「確定」操作で確定できる | **Fail (Blocked: Playwright crash)** | 1. 入力後「確定」をクリック 2. 正誤判定へ遷移 | 同上 |
| E3 | オンスクリーンテンキーのみで完結 | テンキー入力 → 確定までマウス/Enter不要 | **Fail (Blocked: Playwright crash)** | 1. テンキーで数値入力 2. テンキー内の確定/送信操作で回答 | 同上 |
| E4 | 連打時の安定動作 | 連打で二重送信・クラッシュが発生しない | **Fail (Blocked: Playwright crash)** | 1. 確定ボタンを連打 2. 1回分の判定のみ行われる | 同上 |
| E5 | タイムアップ直前の確定 | 残り時間0付近でもクラッシュしない | **Fail (Blocked: Playwright crash)** | 1. タイムアップ直前に確定操作 2. 正常遷移を確認 | 同上 |

---

## 「タイムアップ直前」テストの代替手順（60秒制限回避）

> 60秒待機せずに「タイムアップ直前」を再現するため、テストフラグを使用する手順です。

1. `?test=1&timeLimit=5` を付けてゲームを開始する。
   例: `http://localhost:8000/?test=1&timeLimit=5`
2. 画面上のタイマーが **2秒** 付近に縮むことを確認。
3. **1秒未満** になる直前に「確定」または Enter を実行。
4. タイムアップ遷移と競合してもクラッシュしないことを確認。

---

## まとめ
- Playwright のクラッシュにより UI E2E は実行不能（全件 **Fail/Blocked**）。
- 再実行は Playwright の安定化（SIGSEGV回避）後に推奨。
- 手動テスト手順とタイムアップ代替手順を記録済み。
