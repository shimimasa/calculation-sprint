# ADR-002 / ADR-003 E2E 受け入れ試験結果（ローカル UI）

## 実行環境
- 実行日: 2026-02-05
- 実行コマンド（1本化）: `./tools/adr-e2e`
  - Playwright (firefox) を使用。Chromium は SIGSEGV を確認したため回避。
  - Playwright 未導入の場合は `python tools/adr_e2e.py` がエラーで停止するため、手動実行に切り替える。

## 起動/配信の確認
- 直下配信: `./tools/serve --port 8082` → `http://localhost:8082/` (200)
- サブパス配信: `./tools/serve --port 8083 --subpath` → `http://localhost:8083/calculation-sprint/` (200)

## テストフック（時間短縮）
- `?test=1` のときのみ時間制限を短縮可能（デフォルト 5 秒）。
- `?test=1&timeLimit=5` でタイムアップ直前を再現しやすくする。

## 実行ログ（証跡）
- `spec/test-results/adr-002-003-e2e.log`

---

## ADR-002: 匿名プロファイル必須化 & 記録分離（T1〜T6）

| ID | テスト内容 | 期待結果 | 実施結果 | 再現手順（E2E） | 証跡 |
| --- | --- | --- | --- | --- | --- |
| T1 | 起動時にプロファイル選択が必須 | 起動直後はプロフィール選択画面が表示され、未選択のまま進めない | **Pass** | `?test=1` で起動 → profile-select が表示される | ログ参照 |
| T2 | プロファイル選択・続行 | プロファイル選択で表示が更新され、続行操作が可能 | **Pass** | B を選択 → 「タイトルへすすむ」→ タイトル画面へ | ログ参照 |
| T3 | 選択プロファイルの保持 | lastProfileId が保存される | **Pass** | localStorage の lastProfileId を確認 | ログ参照 |
| T4 | プロファイル変更導線 | 設定からプロファイル変更で選択画面へ戻る | **Pass** | タイトル → 設定 → プロファイル変更 | ログ参照 |
| T5 | プロファイル別データ分離 | Aの記録がBに混在しない | **Pass** | A/B で1セッションずつ実施 → 保存キーが分離 | ログ参照 |
| T6 | プロファイル単位リセット | リセットが選択中プロファイルのみ対象 | **Pass** | A のみリセット → Bの記録が残る | ログ参照 |

---

## ADR-003: 入力 I/F 統一（Enter/クリック/テンキー/連打/タイムアップ直前）

| ID | テスト内容 | 期待結果 | 実施結果 | 再現手順（E2E） | 証跡 |
| --- | --- | --- | --- | --- | --- |
| E1 | Enter で回答確定 | Enter がショートカットとして機能し、確定できる | **Pass** | 正答入力 → Enter | ログ参照 |
| E2 | クリック（確定ボタン）で回答確定 | 画面上の「確定」操作で確定できる | **Pass** | 正答入力 → 「確定」クリック | ログ参照 |
| E3 | オンスクリーンテンキーのみで完結 | テンキー入力 → 確定までマウス/Enter不要 | **Pass** | テンキーで入力 → 確定 | ログ参照 |
| E4 | 連打時の安定動作 | 連打で二重送信・クラッシュが発生しない | **Pass** | 確定ボタン連打 → 正解数+1のみ | ログ参照 |
| E5 | タイムアップ直前の確定 | 残り時間0付近でもクラッシュしない | **Pass** | `timeLimit=5` で残り1秒時に確定 | ログ参照 |

---

## 「タイムアップ直前」テストの代替手順（60秒制限回避）

1. `http://localhost:8082/?test=1&timeLimit=5` でゲーム開始。
2. 残り時間が **1秒** になった瞬間に「確定」または Enter を実行。
3. タイムアップ遷移と競合してもクラッシュしないことを確認。

---

## 既知の残課題
- Chromium headless がこの環境で SIGSEGV を起こすため、Playwright は Firefox を使用。
