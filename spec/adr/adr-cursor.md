作成するファイル一覧（パス付き）
spec/adr/ADR-001.md
spec/adr/ADR-002.md
spec/adr/ADR-003.md
spec/adr/ADR-004.md
spec/adr/ADR-005.md
spec/product-spec.md（SSoT: プロダクト正本）
spec/tech-spec.md（SSoT: 技術正本）
各ADRの見出し構成案（= そのまま各ファイルに貼れる整形案）
# ADR-001: ステージは課題セレクタとし、学習達成を保証するクリア判定は持たないStatus: AcceptedDate: 2026-02-04Source of Truth: spec/adr/adr.md## Context- 現状「ステージ/クリア/開放」の語彙が、学習達成の保証と結びつき誤解を誘発しうる。- 閾値（正答率/速度/ミス等）を早期固定すると現場差で破綻し、後戻りコストが高い。- ポータル統合では「課題選択→実施→振り返り」に揃うことが重要。## Decision- ステージは「おすすめ課題（プリセット＋説明）」のセレクタと定義する。- 次ステージ解放は「前ステージを1回実施」で行い、成績条件では行わない。- UI上の「クリア」は学習達成の保証を意味しない語彙へ移行する（例: 到達/挑戦/実施済み）。## Non-goals- 学習達成（理解/定着）を自動判定する仕組みは作らない。- 先生ごとの閾値カスタマイズ機能はこのADRでは扱わない。- ステージ数増加や世界観演出の拡張は優先しない。## Consequences- 得るもの: 誤学習/誤指導リスク低下、運用適合、統合しやすい課題モデル。- 失うもの: “真のクリア感”は弱くなるため、別軸（称号/バッジ等）で補完が必要。## Terminology- ステージ: おすすめ課題のまとまり（プリセット＋説明＋順序）。- プレイ実施: その課題を開始し、結果画面まで到達した事実（成績は問わない）。- クリア: 用語としては段階的に廃止/再定義（学習達成の保証はしない）。## References- spec/adr/adr.md (ADR-001)
# ADR-002: 共用端末を前提に匿名プロファイル選択を必須化し、記録を完全分離するStatus: AcceptedDate: 2026-02-04Source of Truth: spec/adr/adr.md## Context- 学校/支援現場は共用端末が多く、記録混入は比較・恥・対人トラブルに直結する。- 後付けプロファイルはデータ移行とUI導線が重く、先に塞ぐ方が安い。- 将来ポータル統合では「利用者コンテキスト」との接続が前提になる。## Decision- 起動時に「利用者（匿名）選択」を必須にする（アイコン＋番号等、名前入力は不要）。- 進捗・統計・ランキング等の永続データはプロファイル単位で完全分離する。- リセットは原則「選択中プロファイル単位」。全消去は管理者導線に限定する。## Non-goals- 個人情報（氏名/学籍/メール等）を収集しない。- サーバ同期・アカウント連携（SSO）はこの段階では行わない。- プロファイル間の比較（ランキング統合表示等）は提供しない。## Consequences- 得るもの: 現場運用適合、混入事故の予防、統合基盤への接続容易性。- 失うもの: 起動が1ステップ増える（ただし“最後に使ったプロファイル”で軽減可能）。## Terminology- プロファイル: 端末内の匿名利用者スロット（例: A〜H）。- 完全分離: storageキー/値/進捗がプロファイル間で混ざらないこと。## References- spec/adr/adr.md (ADR-002)
# ADR-003: 回答確定を入力抽象I/Fに統一し、Enter依存を撤廃する（テンキー標準）Status: AcceptedDate: 2026-02-04Source of Truth: spec/adr/adr.md## Context- Enterキー依存はタブレット/スマホ/支援スイッチ等で詰まりやすく、離脱要因になる。- 画面ごとに個別対応すると増築で破綻し、他プロダクト統合時に共通化できない。- 発達特性配慮として「次に何をすればよいか」を常に明示したい。## Decision- “決定（submit）/戻る/次へ”などを扱う入力抽象I/F（アクション層）を採用する。- UIとして常に押せる「確定」操作を標準搭載し、Enterはショートカット扱いにする。- 学習現場向けにオンスクリーンテンキーを標準装備（必要に応じて表示制御）する。## Non-goals- 手書き入力/音声入力の最適化は本ADRの対象外。- 高度なアクセシビリティAPI対応（AT専用フロー）は別途扱う。- IME特殊ケースの完全吸収をここで保証しない（ただし破綻はさせない）。## Consequences- 得るもの: デバイス互換性、見通しの良いUX、統合可能な入力基盤。- 失うもの: 入力設計の作業範囲が広がるため、I/F固定を先行しないとコスト増。## Terminology- 入力抽象I/F: 入力デバイス差を吸収し、アプリに“意図（Action）”として渡す層。- 確定: 回答の送信/判定を開始する一貫した操作。## References- spec/adr/adr.md (ADR-003)
# ADR-004: ポータル統合（サブパス）を正とし、CSSスコープとアセット解決を統一ルール化するStatus: AcceptedDate: 2026-02-04Source of Truth: spec/adr/adr.md## Context- 統合直前の典型事故は「絶対パスで404」「CSS衝突で崩壊」。- 単体配布前提の作りは、サブパス/埋め込みで高確率に破綻する。- 長期運用では“他プロダクトと共存できること”が最重要。## Decision- 配布の正は「サブパス配信」を前提とする（単体直下は副次）。- アセット参照は相対パス/ベースパス可変を原則とし、絶対パス前提を禁止する。- CSSはアプリルート配下にスコープし、グローバルリセットの増築を禁止する。- storageキーはポータル共通の名前空間ルールに従い、衝突を防ぐ。## Non-goals- ビルドツール導入（Vite等）を前提にしない。- デザインシステム統一（全プロダクト同一UI）までは目指さない。- iframe前提の隔離運用に依存しない（使えても“正”にはしない）。## Consequences- 得るもの: 統合耐性、他画面への副作用抑制、長期運用の安全性。- 失うもの: 実装の自由度（安易な絶対パス/全体CSS）が減る＝規約遵守が必須。## Terminology- サブパス: 例 `/portal/games/calc-sprint/` 配下で動く配信形態。- CSSスコープ: アプリ外のDOM/CSSへ影響を漏らさない制約。## References- spec/adr/adr.md (ADR-004)
# ADR-005: 仕様の正本を1つに固定し、以後の判断はADRで積む（SSoT分離）Status: AcceptedDate: 2026-02-04Source of Truth: spec/adr/adr.md## Context- 仕様書が多版併存すると「何が正か」を説明できず、監査/導入/統合で致命傷になる。- プロダクト目的と技術I/Fは更新頻度が異なり、混在すると破綻しやすい。- 重要判断の履歴がないと、後で議論が蒸し返される。## Decision- SSoT（正本）を `spec/product-spec.md` と `spec/tech-spec.md` の2本に分離する。- 旧仕様はアーカイブ扱いとし、参照時は「SSoT＋ADR」を優先する運用にする。- 重要判断はADR-001〜 を追記・更新せず“追加ADR”で積む（履歴を残す）。## Non-goals- 既存の全仕様書を即時に統廃合しない（段階的に移行する）。- 仕様の完全性（網羅100%）を初回から求めない（重要項目優先）。- 実装詳細（関数単位の挙動）をSSoTに書きすぎない。## Consequences- 得るもの: 説明可能性、引継ぎ容易性、統合時の判断速度。- 失うもの: ドキュメント整備コスト（ただし後戻りより安い）。## References- spec/adr/adr.md (ADR-005)
SSoT（spec/product-spec.md / spec/tech-spec.md）の構成案
spec/product-spec.md
目的/成功条件（教育現場・支援・共用端末・導入容易性を最優先）
対象ユーザー/利用シーン（学校/放課後デイ/家庭、先生・支援員）
UX原則（見通し、失敗の安全、比較ストレス抑制、短時間運用）
ゲーム設計の立ち位置（距離/演出は継続支援。学習達成の保証とは分離）
運用モデル（匿名プロファイル、記録の扱い、リセット権限）
禁止事項（個人情報収集、プロファイル混在、学習達成の誤保証、過度な競争デフォルトON など）
用語集（ステージ/実施/復習/記録/プロファイル）
spec/tech-spec.md
アーキテクチャ（screen I/F、screenManager、gameStateの責務境界）
入力I/F（Action層、確定/戻る/次へ、テンキー、支援デバイス想定）
保存（プロファイル単位の名前空間、スキーマversion、移行/破損時方針）
画面遷移（title/settings/game/result + profile選択の位置づけ）
配布/サブパス（ベースパス、アセット解決、URL設計）
CSSスコープ（リセット方針、外部衝突回避、prefers-reduced-motionの扱い）
テスト観点（手動中心）（共用端末・サブパス・入力多様性）
Phase0/Phase1 実装チェックリスト（順序つき：影響ファイル候補 / リスク / 手動テスト観点）
Phase0（破壊を防ぐ土台）
[ ] (0-1) 配布形態を“サブパス正”に固定し、ベースパス戦略を決める
影響ファイル候補: index.html, styles/style.css, src/main.js
リスク: 既存の画像/音声パスが崩れ、統合前に404が潜む
手動テスト: /直下と/subpath/配下の両方で起動、画像・BGM/SFXロード確認
[ ] (0-2) CSSスコープ規約を確定（グローバルリセット禁止、アプリ外へ漏らさない）
影響ファイル候補: styles/style.css, index.html
リスク: ポータル側CSSと衝突、他画面の崩壊
手動テスト: “ポータル風の外部CSSが同居する”想定でレイアウト破綻がないか
[ ] (0-3) storage名前空間ルール（プロファイル前提＋version）を確定
影響ファイル候補: src/core/dailyStatsStore.js, src/core/todayRankStore.js, src/core/stageProgressStore.js
リスク: 既存データの扱い（移行/破棄）が曖昧だと現場トラブル
手動テスト: 既存localStorageがある状態/壊れたJSON/容量制限時の挙動
[ ] (0-4) SSoTドキュメントを配置し、旧仕様の参照ルールを明文化
影響ファイル候補: spec/product-spec.md, spec/tech-spec.md, spec/配下の既存仕様群
リスク: 参照先が分裂したまま運用が続く
手動テスト: 新規メンバーが「正本に辿り着けるか」レビュー
Phase1（運用/UXの致命傷を塞ぐ）
[ ] (1-1) 匿名プロファイル選択を“起動必須”にする（共用端末前提）
影響ファイル候補: index.html（screen追加想定）, src/core/gameState.js, src/core/*Store.js, src/core/screenManager.js, src/screens/titleScreen.js
リスク: 導線が増えて現場が止まる（= 最後に使ったプロファイルの自動選択等の救済が必要）
手動テスト: A/B 2人分でプレイ→結果→記録/進捗/TOP3が混ざらない
[ ] (1-2) 記録/進捗/TOP3をプロファイル完全分離（キー・UI・リセット含む）
影響ファイル候補: dailyStatsStore.js, todayRankStore.js, stageProgressStore.js, src/screens/resultScreen.js, src/screens/stageSelectScreen.js
リスク: 既存保存データの移行判断ミス（混入・消失）
手動テスト: プロファイル切替→直近7日/今日TOP3/ステージ状態が正しく切り替わる
[ ] (1-3) ステージを“課題セレクタ”に揃える（語彙と進捗の再定義）
影響ファイル候補: src/features/stages.js, src/screens/stageSelectScreen.js, src/screens/resultScreen.js, src/core/stageProgressStore.js
リスク: 「クリア」表示が残り誤解が継続、進捗条件が中途半端になる
手動テスト: “実施済み”が正しく反映、次ステージが「実施」で解放される
[ ] (1-4) 入力抽象I/F導入（submit/back/next）＋確定ボタン標準化
影響ファイル候補: src/core/input.js（現状スタブ）, src/screens/gameScreen.js, src/ui/domRefs.js, index.html, styles/style.css
リスク: 二重送信/ロック競合（タイムアップやフィードバック中の入力）を誘発
手動テスト: Enter/クリック/タップで同一結果、連打・タイムアップ直前・復習上限到達の競合
[ ] (1-5) オンスクリーンテンキー標準装備（現場向け）
影響ファイル候補: index.html, styles/style.css, src/screens/gameScreen.js, src/ui/*
リスク: 画面占有で問題表示が窮屈、誤タップ増加
手動テスト: スマホ幅/タブレット幅で操作成立、誤操作からの復帰が簡単
必要なら次の一手として、「spec/tech-spec.mdに書く“入力I/F（Action一覧）”の最小セット（Submit/Cancel/Back/Next/FocusAnswer 等）」まで先に確定して、Phase1の実装ブレを潰すところまで分解します。