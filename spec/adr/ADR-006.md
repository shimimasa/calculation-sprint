# ADR-006: 統合耐性の最終補修（入力Action契約/ CSSスコープ強化/ 配布導線の固定）

Status: Accepted
Date: 2026-02-06

## Context

- 統合時の残存リスクは「入力Action契約の揺れ」「CSSの隠れグローバル（@keyframes/@property）」「配布導線の曖昧さ」。
- 端末/入力デバイス差の吸収は ADR-003 で決めたが、契約の具体的なキー対応が未固定だと現場で揺れる。
- CSSは`.calc-sprint`配下へスコープ済みだが、`@keyframes`や`@property`はグローバル登録のため衝突余地が残る。
- README導線が分散すると「何を正として見ればよいか」が揺れる（ADR-005のSSoT運用と矛盾）。

## Decision

1. **入力Action契約の具体キー対応を固定**する。
   - `submit`: Enter / NumpadEnter / 画面内確定ボタン
   - `back`: Backspace / Delete / テンキー⌫
   - `next`: Space / ArrowRight
   - `toggle_keypad`: 画面内トグルボタン
2. **CSSの隠れグローバルを排除**する。
   - `@keyframes` と `@property` は `calc-sprint-` プレフィックスを付ける。
3. **配布導線はREADME→SSoT→ADRの順に固定**し、配布起動は `tools/serve` を正とする（ADR-005に整合）。

## Non-goals

- 新しい入力デバイス（音声/手書き等）への最適化は含めない。
- デザイン刷新や演出の大改修は行わない。
- ビルドツールの追加は行わない。

## Consequences

- 得るもの: 入力I/Fのブレが減り、統合環境でもCSS衝突が起きにくくなる。
- 失うもの: 命名ルールの制約（プレフィックス付与）が増える。

## References

- spec/adr/ADR-003.md
- spec/adr/ADR-004.md
- spec/adr/ADR-005.md
- spec/product-spec.md
- spec/tech-spec.md
- spec/test-results/adr-acceptance-latest.md
